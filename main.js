!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",modalInputErrorClass:"modal__input_type_error",inactiveButtonClass:"modal__submit-button_disabled"},t=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.modalInputErrorClass),o.textContent=""},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?o:r}function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Saving...";const o=t.submitter,a=o.textContent;n(o,!0,a,r),e().then((()=>{t.target.reset()})).catch((e=>{console.error(e)})).finally((()=>{n(o,!1,a)}))}const s=document.querySelectorAll(".modal"),i=document.querySelectorAll(".modal__close-button"),l=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__new-button"),c=document.querySelector(".profile__name"),u=document.querySelector(".profile__description"),m=document.querySelector(".profile__avatar"),_=document.querySelector(".profile__avatar-button"),h=document.querySelector("#edit-avatar"),p=document.forms["edit-avatar"],v=h.querySelector("#avatar-link-input"),f=(h.querySelector(".modal__submit-button"),document.querySelector("#popup-modal")),y=f.querySelector(".modal__image"),b=f.querySelector(".modal__caption"),S=document.querySelector("#add-modal"),q=document.forms["new-post"],g=S.querySelector("#add-image-link-input"),E=S.querySelector("#add-caption-input"),L=(S.querySelector(".modal__submit-button"),document.querySelector("#edit-modal")),k=L.querySelector("#profile-name-input"),C=L.querySelector("#profile-description-input"),U=document.forms["edit-profile"],x=(L.querySelector(".modal__submit-button"),document.querySelector("#card-template")),A=document.querySelector(".cards__list"),$=document.querySelector("#delete-modal"),I=($.querySelector(".modal__submit-button"),document.forms["delete-card"]),w=$.querySelector(".modal__submit-button_type_cancel");let T,N;const P=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e){let{url:t,options:r}=e;return fetch(t,r).then(this._checkResponse)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._request({url:`${this._baseUrl}/cards`,options:{headers:this._headers}})}getUserInfo(){return this._request({url:`${this._baseUrl}/users/me`,options:{headers:this._headers}})}editUserInfo(e){let{name:t,about:r}=e;return this._request({url:`${this._baseUrl}/users/me`,options:{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}})}editAvatar(e){return this._request({url:`${this._baseUrl}/users/me/avatar`,options:{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}})}addNewCard(e){let{name:t,link:r}=e;return this._request({url:`${this._baseUrl}/cards`,options:{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}})}deleteCard(e){return this._request({url:`${this._baseUrl}/cards/${e}`,options:{method:"DELETE",headers:this._headers}})}toggleLike(e,t){return this._request({url:`${this._baseUrl}/cards/${e}/likes`,options:{method:t?"DELETE":"PUT",headers:this._headers}})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"688c9307-1ad5-4d00-8cf7-8ff6067c0470","Content-Type":"application/json"}});function B(e){e.classList.add("modal_opened"),document.addEventListener("keydown",j)}function O(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",j)}function j(e){"Escape"===e.key&&O(document.querySelector(".modal_opened"))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";const r=function(e){const t=x.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return e.isLiked&&n.classList.toggle("card__like-button_liked"),r.textContent=e.name,o.src=e.link,o.alt=e.name+" image",o.addEventListener("click",(()=>{y.src=e.link,y.alt=e.name+" image",b.textContent=e.name,y.onload=function(){y.classList.remove("modal__image_type_landscape","modal__image_type_portrait"),this.width>this.height?y.classList.add("modal__image_type_landscape"):y.classList.add("modal__image_type_portrait")},B(f)})),n.addEventListener("click",(t=>{!function(e,t){const r=e.isLiked;P.toggleLike(t,r).then((()=>{e.target.classList.toggle("card__like-button_liked")})).catch((e=>{console.error(e)}))}(t,e._id)})),a.addEventListener("click",(()=>function(e,t){T=e,N=t._id,B($)}(t,e))),t}(e);A[t](r)}var J;P.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{D(e,"append")})),m.src=r.avatar,c.textContent=r.name,u.textContent=r.about})).catch((e=>{console.error(e)})),_.addEventListener("click",(()=>{B(h)})),p.addEventListener("submit",(t=>function(t){a((function(){return P.editAvatar(v.value).then((r=>{m.src=r.avatar,t.target.reset(),o(t.submitter,e),O(h)}))}),t)}(t))),I.addEventListener("submit",(function(e){a((function(){return P.deleteCard(N).then((()=>{T.remove(),O($)}))}),e,"deleting...")})),w.addEventListener("click",(()=>{O($)})),l.addEventListener("click",(()=>{(function(){var r,o;k.value=c.textContent,C.value=u.textContent,r=L,o=e,[k,C].forEach((e=>{t(r,e,o)}))})(),B(L)})),i.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>{O(t)}))})),s.forEach((e=>{e.addEventListener("click",(t=>{t.target.closest(".modal__container")||O(e)}))})),U.addEventListener("submit",(function(t){a((function(){return P.editUserInfo({name:k.value,about:C.value}).then((r=>{c.textContent=r.name,u.textContent=r.about,o(t.submitter,e),O(L)}))}),t)})),q.addEventListener("submit",(function(t){a((function(){return P.addNewCard({name:E.value,link:g.value}).then((r=>{D(r),o(t.submitter,e),O(S)}))}),t)})),d.addEventListener("click",(()=>{B(S)})),J=e,Array.from(document.querySelectorAll(J.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(n,a,o),n.forEach((s=>{s.addEventListener("input",(()=>{((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.modalInputErrorClass),n.textContent=r})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)}))}))})(e,J)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SSxJQUNoQkEsRUFBWW9ILGlCQUFpQixVQUFXdkYsSUFDdENBLEVBQUk2SCxnQkFBZ0IsSUFyQkFDLEVBQUMzSixFQUFhRSxLQUN0QyxNQUFNUSxFQUFZOEksTUFBTUMsS0FDdEJ6SixFQUFZMkMsaUJBQWlCekMsRUFBT1AsZ0JBRWhDZ0IsRUFBZ0JYLEVBQVlJLGNBQWNGLEVBQU9OLHNCQUV2RGEsRUFBa0JDLEVBQVdDLEVBQWVULEdBRTVDUSxFQUFVcUksU0FBUzlJLElBQ2pCQSxFQUFhbUgsaUJBQWlCLFNBQVMsS0FoRGhCd0MsRUFBQzVKLEVBQWFDLEVBQWNDLEtBQ2hERCxFQUFhWSxTQUFTQyxNQVF6QmYsRUFBZUMsRUFBYUMsRUFBY0MsR0FyQnZCMkosRUFBQzdKLEVBQWFDLEVBQWM2SixFQUFjNUosS0FDL0QsTUFBTUMsRUFBZUgsRUFBWUksY0FBYyxJQUFJSCxFQUFhSSxZQUNoRUosRUFBYUssVUFBVVksSUFBSWhCLEVBQU9MLHNCQUNsQ00sRUFBYUssWUFBY3NKLENBQVksRUFXckNELENBQ0U3SixFQUNBQyxFQUNBQSxFQUFhOEosa0JBQ2I3SixFQUlKLEVBdUNJMEosQ0FBbUI1SixFQUFhQyxFQUFjQyxHQUM5Q08sRUFBa0JDLEVBQVdDLEVBQWVULEVBQU8sR0FDbkQsR0FDRixFQVVBeUosQ0FBa0IzSixFQUFhRSxFQUFPLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXG4gIG1vZGFsSW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLm1vZGFsSW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLm1vZGFsSW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihcbiAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxuICAgICAgY29uZmlnXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5jb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XG5cbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmV4cG9ydCB7IHNldHRpbmdzLCBkaXNhYmxlQnV0dG9uLCBlbmFibGVWYWxpZGF0aW9uLCByZXNldFZhbGlkYXRpb24gfTtcbi8vZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcbiAgYnRuLFxuICBpc0xvYWRpbmcsXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxuKSB7XG4gIGJ0bi50ZXh0Q29udGVudCA9IGlzTG9hZGluZyA/IGxvYWRpbmdUZXh0IDogZGVmYXVsdFRleHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVTdWJtaXQocmVxdWVzdCwgZXZ0LCBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCIpIHtcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgY29uc3QgaW5pdGlhbFRleHQgPSBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7XG5cbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIHRydWUsIGluaXRpYWxUZXh0LCBsb2FkaW5nVGV4dCk7XG5cbiAgcmVxdWVzdCgpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSwgaW5pdGlhbFRleHQpO1xuICAgIH0pO1xufVxuIiwiaW1wb3J0IHtcbiAgc2V0dGluZ3MsXG4gIGRpc2FibGVCdXR0b24sXG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHJlc2V0VmFsaWRhdGlvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0LCBoYW5kbGVTdWJtaXQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xuXG4vKlxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJHb2xkZW4gZ2F0ZSBicmlkZ2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG5dO1xuKi9cbi8vYWxsIG1vZGFsc1xuY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcbmNvbnN0IGNsb3NlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKTtcblxuLy9wcm9maWxlIHN0dWZmXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBwcm9maWxlTmV3QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uZXctYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG4vL2F2YXRhciBzdHVmZlxuY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgZWRpdEF2YXRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRBdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXJcIik7XG5jb25zdCBlZGl0QXZhdGFyRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1hdmF0YXJcIl07XG5jb25zdCBlZGl0QXZhdGFySW5wdXQgPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbGluay1pbnB1dFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJTdWJtaXRCdXR0b24gPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIlxuKTtcblxuLy9wcmV2aWV3IHdpbmRvdyBtb2RhbFxuY29uc3QgcG9wdXBNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtbW9kYWxcIik7XG5jb25zdCBwb3B1cE1vZGFsSW1hZ2UgPSBwb3B1cE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcG9wdXBNb2RhbENhcHRpb24gPSBwb3B1cE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbi8vYWRkIG5ldyBjYXJkIHN0dWZmXG5jb25zdCBhZGRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLW1vZGFsXCIpO1xuY29uc3QgYWRkRm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1tcIm5ldy1wb3N0XCJdO1xuY29uc3QgYWRkTGlua0lucHV0ID0gYWRkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtaW1hZ2UtbGluay1pbnB1dFwiKTtcbmNvbnN0IGFkZENhcHRpb25JbnB1dCA9IGFkZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcHRpb24taW5wdXRcIik7XG5jb25zdCBhZGRNb2RhbFN1Ym1pdEJ1dHRvbiA9IGFkZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XG5cbi8vZWRpdCBwcm9maWxlIHN0dWZmXG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtbW9kYWxcIik7XG5jb25zdCBtb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IG1vZGFsRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZVwiXTtcbmNvbnN0IGVkaXRNb2RhbFN1Ym1pdEJ1dHRvbiA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpO1xuXG4vL2NhcmQgc3R1ZmZcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vZGVsZXRlIGNhcmQgc3R1ZmZcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XG5jb25zdCBkZWxldGVNb2RhbFN1Ym1pdEJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCJcbik7XG5jb25zdCBkZWxldGVGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJkZWxldGUtY2FyZFwiXTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25fdHlwZV9jYW5jZWxcIlxuKTtcblxubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjY4OGM5MzA3LTFhZDUtNGQwMC04Y2Y3LThmZjYwNjdjMDQ3MFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJdKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgcmVuZGVyQ2FyZChjYXJkLCBcImFwcGVuZFwiKTtcbiAgICB9KTtcbiAgICBwcm9maWxlQXZhdGFyLnNyYyA9IHVzZXIuYXZhdGFyO1xuICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlci5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXIuYWJvdXQ7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICB9KTtcblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZE5hbWVFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZExpbmtFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XG4gIH1cblxuICBjYXJkTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRMaW5rRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRMaW5rRWxlbWVudC5hbHQgPSBkYXRhLm5hbWUgKyBcIiBpbWFnZVwiO1xuXG4gIGNhcmRMaW5rRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHBvcHVwTW9kYWxJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gICAgcG9wdXBNb2RhbEltYWdlLmFsdCA9IGRhdGEubmFtZSArIFwiIGltYWdlXCI7XG4gICAgcG9wdXBNb2RhbENhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG5cbiAgICBwb3B1cE1vZGFsSW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgcG9wdXBNb2RhbEltYWdlLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAgIFwibW9kYWxfX2ltYWdlX3R5cGVfbGFuZHNjYXBlXCIsXG4gICAgICAgIFwibW9kYWxfX2ltYWdlX3R5cGVfcG9ydHJhaXRcIlxuICAgICAgKTtcblxuICAgICAgaWYgKHRoaXMud2lkdGggPiB0aGlzLmhlaWdodCkge1xuICAgICAgICBwb3B1cE1vZGFsSW1hZ2UuY2xhc3NMaXN0LmFkZChcIm1vZGFsX19pbWFnZV90eXBlX2xhbmRzY2FwZVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBvcHVwTW9kYWxJbWFnZS5jbGFzc0xpc3QuYWRkKFwibW9kYWxfX2ltYWdlX3R5cGVfcG9ydHJhaXRcIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIG9wZW5Nb2RhbChwb3B1cE1vZGFsKTtcbiAgfSk7XG5cbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBoYW5kbGVMaWtlQnV0dG9uKGV2dCwgZGF0YS5faWQpO1xuICB9KTtcblxuICBjYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpXG4gICk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5lZGl0QXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5cbmVkaXRBdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkpO1xuXG4vKiBmdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIHNldEJ1dHRvblRleHQoZWRpdEF2YXRhclN1Ym1pdEJ1dHRvbiwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0QXZhdGFyKGVkaXRBdmF0YXJJbnB1dC52YWx1ZSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oZWRpdEF2YXRhclN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoZWRpdEF2YXRhclN1Ym1pdEJ1dHRvbiwgZmFsc2UpO1xuICAgIH0pO1xufVxuICovXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KCkge1xuICAgIHJldHVybiBhcGkuZWRpdEF2YXRhcihlZGl0QXZhdGFySW5wdXQudmFsdWUpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGV2dC5zdWJtaXR0ZXIsIHNldHRpbmdzKTtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcbiAgICB9KTtcbiAgfVxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUxpa2VCdXR0b24oZXZ0LCBpZCkge1xuICBjb25zdCBpc0xpa2VkID0gZXZ0LmlzTGlrZWQ7XG5cbiAgYXBpXG4gICAgLnRvZ2dsZUxpa2UoaWQsIGlzTGlrZWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xufVxuXG4vKiBmdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoKSB7XG4gIHNldEJ1dHRvblRleHQoZGVsZXRlTW9kYWxTdWJtaXRCdXR0b24sIHRydWUsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoZGVsZXRlTW9kYWxTdWJtaXRCdXR0b24sIGZhbHNlLCBcIkRlbGV0ZVwiKTtcbiAgICB9KTtcbn0gKi9cblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xuICBmdW5jdGlvbiBtYWtlUmVxdWVzdCgpIHtcbiAgICByZXR1cm4gYXBpLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgfSk7XG4gIH1cbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQsIFwiZGVsZXRpbmcuLi5cIik7XG59XG5cbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xuXG5kZWxldGVNb2RhbENhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xuXG4vKiBmdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZUZvcm1TdWJtaXQoKSB7XG4gIHNldEJ1dHRvblRleHQoZWRpdE1vZGFsU3VibWl0QnV0dG9uLCB0cnVlKTtcbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBtb2RhbE5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBtb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgICAgZGlzYWJsZUJ1dHRvbihlZGl0TW9kYWxTdWJtaXRCdXR0b24sIHNldHRpbmdzKTtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChlZGl0TW9kYWxTdWJtaXRCdXR0b24sIGZhbHNlKTtcbiAgICB9KTtcbn0gKi9cblxuZnVuY3Rpb24gaGFuZGxlRWRpdFByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBmdW5jdGlvbiBtYWtlUmVxdWVzdCgpIHtcbiAgICByZXR1cm4gYXBpXG4gICAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgICAgbmFtZTogbW9kYWxOYW1lSW5wdXQudmFsdWUsXG4gICAgICAgIGFib3V0OiBtb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgICB9KVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICAgIGRpc2FibGVCdXR0b24oZXZ0LnN1Ym1pdHRlciwgc2V0dGluZ3MpO1xuICAgICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XG4gICAgICB9KTtcbiAgfVxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XG59XG5cbi8qIGZ1bmN0aW9uIGhhbmRsZUFkZFByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBjb25zdCBpbnB1dFZhbHVlcyA9IHsgbmFtZTogYWRkQ2FwdGlvbklucHV0LnZhbHVlLCBsaW5rOiBhZGRMaW5rSW5wdXQudmFsdWUgfTtcbiAgc2V0QnV0dG9uVGV4dChhZGRNb2RhbFN1Ym1pdEJ1dHRvbiwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5hZGROZXdjYXJkKGlucHV0VmFsdWVzKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICByZW5kZXJDYXJkKGRhdGEpO1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgZGlzYWJsZUJ1dHRvbihhZGRNb2RhbFN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChhZGRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KGFkZE1vZGFsU3VibWl0QnV0dG9uLCBmYWxzZSk7XG4gICAgfSk7XG59ICovXG5cbmZ1bmN0aW9uIGhhbmRsZUFkZFByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBmdW5jdGlvbiBtYWtlUmVxdWVzdCgpIHtcbiAgICByZXR1cm4gYXBpXG4gICAgICAuYWRkTmV3Q2FyZCh7IG5hbWU6IGFkZENhcHRpb25JbnB1dC52YWx1ZSwgbGluazogYWRkTGlua0lucHV0LnZhbHVlIH0pXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICByZW5kZXJDYXJkKGRhdGEpO1xuICAgICAgICBkaXNhYmxlQnV0dG9uKGV2dC5zdWJtaXR0ZXIsIHNldHRpbmdzKTtcbiAgICAgICAgY2xvc2VNb2RhbChhZGRNb2RhbCk7XG4gICAgICB9KTtcbiAgfVxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XG59XG5cbmZ1bmN0aW9uIGZpbGxQcm9maWxlRm9ybSgpIHtcbiAgbW9kYWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgbW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oZWRpdE1vZGFsLCBbbW9kYWxOYW1lSW5wdXQsIG1vZGFsRGVzY3JpcHRpb25JbnB1dF0sIHNldHRpbmdzKTtcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGVzY2FwZU1vZGFsKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBlc2NhcGVNb2RhbCk7XG59XG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGZpbGxQcm9maWxlRm9ybSgpO1xuICBvcGVuTW9kYWwoZWRpdE1vZGFsKTtcbn0pO1xuXG5jbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gIGNvbnN0IHBvcHVwID0gYnV0dG9uLmNsb3Nlc3QoXCIubW9kYWxcIik7XG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlTW9kYWwocG9wdXApO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiBlc2NhcGVNb2RhbChldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBhY3RpdmVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xuICAgIGNsb3NlTW9kYWwoYWN0aXZlTW9kYWwpO1xuICB9XG59XG5cbm1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgIGlmICghZXZ0LnRhcmdldC5jbG9zZXN0KFwiLm1vZGFsX19jb250YWluZXJcIikpIHtcbiAgICAgIGNsb3NlTW9kYWwobW9kYWwpO1xuICAgIH1cbiAgfSk7XG59KTtcblxuZWRpdEZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRWRpdFByb2ZpbGVGb3JtU3VibWl0KTtcblxuYWRkRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRQcm9maWxlRm9ybVN1Ym1pdCk7XG5cbnByb2ZpbGVOZXdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGFkZE1vZGFsKTtcbn0pO1xuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGNhcmQsIG1ldGhvZCA9IFwicHJlcGVuZFwiKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZCk7XG4gIGNhcmRzTGlzdFttZXRob2RdKGNhcmRFbGVtZW50KTtcbn1cblxuLypcbmluaXRpYWxDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gIHJlbmRlckNhcmQoY2FyZCk7XG59KTtcbiovXG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBfcmVxdWVzdCh7IHVybCwgb3B0aW9ucyB9KSB7XG4gICAgcmV0dXJuIGZldGNoKHVybCwgb3B0aW9ucykudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICAvKiByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTsgKi9cbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdCh7XG4gICAgICB1cmw6IGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCxcbiAgICAgIG9wdGlvbnM6IHsgaGVhZGVyczogdGhpcy5faGVhZGVycyB9LFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3Qoe1xuICAgICAgdXJsOiBgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsXG4gICAgICBvcHRpb25zOiB7IGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMgfSxcbiAgICB9KTtcbiAgICAvKiByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTsgKi9cbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdCh7XG4gICAgICB1cmw6IGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXG4gICAgICB9LFxuICAgIH0pO1xuICAgIC8qIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7ICovXG4gIH1cblxuICBlZGl0QXZhdGFyKGF2YXRhcikge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgIHVybDogYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyIH0pLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICAvKiByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7ICovXG4gIH1cblxuICBhZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3Qoe1xuICAgICAgdXJsOiBgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgLyogIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pOyAqL1xuICB9XG5cbiAgZGVsZXRlQ2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgIHVybDogYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLFxuICAgICAgb3B0aW9uczogeyBtZXRob2Q6IFwiREVMRVRFXCIsIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMgfSxcbiAgICB9KTtcblxuICAgIC8qIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pOyAqL1xuICB9XG5cbiAgdG9nZ2xlTGlrZShpZCwgaXNMaWtlZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KHtcbiAgICAgIHVybDogYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLFxuICAgICAgb3B0aW9uczogeyBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIiwgaGVhZGVyczogdGhpcy5faGVhZGVycyB9LFxuICAgIH0pO1xuICAgIC8qIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7ICovXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIm1vZGFsSW5wdXRFcnJvckNsYXNzIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJjb25maWciLCJlcnJvckVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwic2V0QnV0dG9uVGV4dCIsImJ0biIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwibG9hZGluZ1RleHQiLCJoYW5kbGVTdWJtaXQiLCJyZXF1ZXN0IiwiZXZ0Iiwic3VibWl0QnV0dG9uIiwic3VibWl0dGVyIiwiaW5pdGlhbFRleHQiLCJ0aGVuIiwidGFyZ2V0IiwicmVzZXQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImZpbmFsbHkiLCJtb2RhbHMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjbG9zZUJ1dHRvbnMiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVOZXdCdXR0b24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVBdmF0YXIiLCJlZGl0QXZhdGFyQnV0dG9uIiwiZWRpdEF2YXRhck1vZGFsIiwiZWRpdEF2YXRhckZvcm0iLCJmb3JtcyIsImVkaXRBdmF0YXJJbnB1dCIsInBvcHVwTW9kYWwiLCJwb3B1cE1vZGFsSW1hZ2UiLCJwb3B1cE1vZGFsQ2FwdGlvbiIsImFkZE1vZGFsIiwiYWRkRm9ybUVsZW1lbnQiLCJhZGRMaW5rSW5wdXQiLCJhZGRDYXB0aW9uSW5wdXQiLCJlZGl0TW9kYWwiLCJtb2RhbE5hbWVJbnB1dCIsIm1vZGFsRGVzY3JpcHRpb25JbnB1dCIsImVkaXRGb3JtRWxlbWVudCIsImNhcmRUZW1wbGF0ZSIsImNhcmRzTGlzdCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsImRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiX3JlcXVlc3QiLCJfcmVmMiIsInVybCIsIm9wdGlvbnMiLCJmZXRjaCIsImdldEFwcEluZm8iLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImVkaXRVc2VySW5mbyIsIl9yZWYzIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFyIiwiYXZhdGFyIiwiYWRkTmV3Q2FyZCIsIl9yZWY0IiwibGluayIsImRlbGV0ZUNhcmQiLCJ0b2dnbGVMaWtlIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJvcGVuTW9kYWwiLCJtb2RhbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlc2NhcGVNb2RhbCIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwicmVuZGVyQ2FyZCIsImNhcmQiLCJjYXJkRWxlbWVudCIsImRhdGEiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbGVtZW50IiwiY2FyZExpbmtFbGVtZW50IiwiY2FyZExpa2VCdXR0b24iLCJjYXJkRGVsZXRlQnV0dG9uIiwidG9nZ2xlIiwic3JjIiwiYWx0Iiwib25sb2FkIiwid2lkdGgiLCJoZWlnaHQiLCJoYW5kbGVMaWtlQnV0dG9uIiwiX2lkIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImdldENhcmRFbGVtZW50IiwiY2FyZHMiLCJ1c2VyIiwiZm9yRWFjaCIsInZhbHVlIiwiaGFuZGxlQXZhdGFyU3VibWl0IiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJmaWxsUHJvZmlsZUZvcm0iLCJidXR0b24iLCJwb3B1cCIsImNsb3Nlc3QiLCJBcnJheSIsImZyb20iLCJwcmV2ZW50RGVmYXVsdCIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=